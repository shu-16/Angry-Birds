// Canvas設定
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 400;

// ゲーム状態
let gameState = {
    player: { x: 50, y: 200, width: 30, height: 30 },
    obstacles: [],
    score: 0,
    gameOver: false
};

// ゲームループ
function gameLoop() {
    update();
    draw();
    if (!gameState.gameOver) {
        requestAnimationFrame(gameLoop);
    }
}

// 更新関数
function update() {
    // プレイヤーの重力
    gameState.player.y += 2;
    
    // 障害物の移動
    gameState.obstacles.forEach(obstacle => {
        obstacle.x -= 5;
    });
    
    // 新しい障害物の生成
    if (Math.random() < 0.02) {
        gameState.obstacles.push({
            x: canvas.width,
            y: Math.random() * (canvas.height - 50),
            width: 30,
            height: 100
        });
    }
    
    // 衝突判定
    gameState.obstacles.forEach(obstacle => {
        if (collision(gameState.player, obstacle)) {
            gameState.gameOver = true;
        }
    });
    
    // スコア更新
    gameState.score++;
}

// 描画関数
function draw() {
    // 背景のクリア
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // プレイヤーの描画
    ctx.fillStyle = 'blue';
    ctx.fillRect(gameState.player.x, gameState.player.y, gameState.player.width, gameState.player.height);
    
    // 障害物の描画
    ctx.fillStyle = 'red';
    gameState.obstacles.forEach(obstacle => {
        ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
    });
    
    // スコアの表示
    ctx.fillStyle = 'black';
    ctx.font = '20px Arial';
    ctx.fillText(`Score: ${gameState.score}`, 10, 30);
    
    // ゲームオーバー表示
    if (gameState.gameOver) {
        ctx.fillStyle = 'black';
        ctx.font = '40px Arial';
        ctx.fillText('Game Over', canvas.width / 2 - 100, canvas.height / 2);
    }
}

// 衝突判定関数
function collision(a, b) {
    return a.x < b.x + b.width &&
           a.x + a.width > b.x &&
           a.y < b.y + b.height &&
           a.y + a.height > b.y;
}

// タップ（クリック）イベント
canvas.addEventListener('click', () => {
    gameState.player.y -= 50;
});

// ゲーム開始
gameLoop();
